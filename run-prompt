#!/bin/bash

if [ -z "$1" ]; then
    echo "Usage: $0 <prompt> <file>"
    exit 1
fi

# Try different variations of the prompt file
PROMPT_FILE=""
PROMPT_NAME="$1"
PROMPT_NAME_MD="${PROMPT_NAME%.md}.md"  # Ensure .md extension

# Check in current directory
if [ -f "$PROMPT_NAME" ]; then
    PROMPT_FILE="$PROMPT_NAME"
elif [ -f "$PROMPT_NAME_MD" ]; then
    PROMPT_FILE="$PROMPT_NAME_MD"
# Check in script directory
elif [ -f "$SCRIPT_DIR/$PROMPT_NAME" ]; then
    PROMPT_FILE="$SCRIPT_DIR/$PROMPT_NAME"
elif [ -f "$SCRIPT_DIR/$PROMPT_NAME_MD" ]; then
    PROMPT_FILE="$SCRIPT_DIR/$PROMPT_NAME_MD"
fi

if [ -z "$PROMPT_FILE" ]; then
    echo "Unable to find prompt file: $PROMPT_NAME (also tried with .md extension)"
    exit 1
fi

# Get MODEL from environment, default to claude-3.7-sonnet
MODEL=${MODEL:-claude-3.7-sonnet}

echo "[$MODEL] Running prompt: $PROMPT_FILE"

if [ -z "$2" ]; then
    # If no file is specified, read from stdin
    cat | \
    llm -m $MODEL \
        "$(cat $PROMPT_FILE)"
else
    # Read from the specified file
    cat "$2" | \
    llm -m $MODEL \
        "$(cat $PROMPT_FILE)"
fi
	